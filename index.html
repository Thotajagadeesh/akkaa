<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Happy Birthday Swaraaaa</title>
<meta name="description" content="Birthday animation with music">
<link rel="icon" href="https://cdn.jsdelivr.net/gh/sun0225SUN/photos/img/20210715233345.png" type="image/x-icon">
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #000;
    }
    canvas {
        position: absolute;
        width: 100%;
        height: 100%;
    }
    .overlay {
        position: absolute;
        width: 100%;
        z-index: 10000;
    }
    .tabs-labels span {
        color: white;
        margin: 0 10px;
        cursor: pointer;
    }
</style>
</head>
<body>

<canvas class="canvas"></canvas>

<div class="overlay">
    <div class="tabs">
        <div class="tabs-labels">
            <span class="tabs-label">Commands</span>
            <span class="tabs-label">Info</span>
            <span class="tabs-label">Share</span>
        </div>
        <div class="tabs-panels">
            <ul class="tabs-panel commands"></ul>
        </div>
    </div>
</div>

<script>
// ======================
// üéµ Background Audio
// ======================
let audio = new Audio("js/audio.mpeg");
audio.loop = true;
document.addEventListener("click", () => { audio.play(); }, { once: true });

// ======================
// üéâ Birthday Animation
// ======================
var S = {
    init: function () {
        var action = window.location.href, i = action.indexOf('?a=');
        S.Drawing.init('.canvas');
        document.body.classList.add('body--ready');
        if (i !== -1) {
            S.UI.simulate(decodeURI(action).substring(i + 3));
        } else {
            S.UI.simulate('|#countdown 3||HAPPY|BIRTHDAY|ANUSHA|AKKA|‚ù§|#rectangle|');
        }
        S.Drawing.loop(function () { S.Shape.render(); });
    }
};

// ======================
// Drawing Module
// ======================
S.Drawing = (function () {
    var canvas, context, renderFn,
    requestFrame = window.requestAnimationFrame ||
                   window.webkitRequestAnimationFrame ||
                   window.mozRequestAnimationFrame ||
                   window.oRequestAnimationFrame ||
                   window.msRequestAnimationFrame ||
                   function(callback){ window.setTimeout(callback, 1000/60); };
    return {
        init: function(el) { canvas = document.querySelector(el); context = canvas.getContext('2d'); this.adjustCanvas(); window.addEventListener('resize', S.Drawing.adjustCanvas); },
        loop: function(fn) { renderFn = !renderFn ? fn : renderFn; this.clearFrame(); renderFn(); requestFrame.call(window, this.loop.bind(this)); },
        adjustCanvas: function() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; },
        clearFrame: function() { context.clearRect(0, 0, canvas.width, canvas.height); },
        getArea: function() { return { w: canvas.width, h: canvas.height }; },
        drawCircle: function(p, c) { context.fillStyle = c.render(); context.beginPath(); context.arc(p.x, p.y, p.z, 0, 2*Math.PI, true); context.closePath(); context.fill(); },
        getContext: function() { return context; }
    };
}());

// ======================
// UI Module
// ======================
S.UI = (function () {
    var canvas = document.querySelector('.canvas'), interval, sequence = [], maxShapeSize = 30;
    function getValue(value){ return value && value.split(' ')[1]; }
    function getAction(value){ value = value && value.split(' ')[0]; return value && value[0]==='#' && value.substring(1); }
    function timedAction(fn, delay, max, reverse) {
        clearInterval(interval); var current = reverse ? max : 1; fn(current);
        if(!max || (!reverse && current<max) || (reverse && current>0)) {
            interval = setInterval(function(){ current = reverse ? current-1 : current+1; fn(current); if((!reverse && max && current===max) || (reverse && current===0)) clearInterval(interval); }, delay);
        }
    }
    function performAction(value) {
        sequence = typeof(value)==='object'? value: sequence.concat(value.split('|'));
        timedAction(function() {
            var current = sequence.shift(), action = getAction(current), val = getValue(current);
            switch(action){
                case 'countdown':
                    val = parseInt(val)||10;
                    timedAction(function(i){ S.Shape.switchShape(S.ShapeBuilder.letter(i), true); }, 1000, val, true);
                    break;
                case 'rectangle':
                    val = val && val.split('x'); val = (val && val.length===2) ? val : [maxShapeSize, maxShapeSize/2];
                    S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(maxShapeSize, parseInt(val[0])), Math.min(maxShapeSize, parseInt(val[1]))));
                    break;
                case 'circle':
                    val = parseInt(val)||maxShapeSize; val=Math.min(val,maxShapeSize);
                    S.Shape.switchShape(S.ShapeBuilder.circle(val));
                    break;
                default:
                    S.Shape.switchShape(S.ShapeBuilder.letter(current[0]==='#'?'What?':current));
            }
        }, 2000, sequence.length);
    }
    function init() {
        document.body.addEventListener('keydown', function(e){ if(e.keyCode===13){ performAction("HAPPY|BIRTHDAY|ANUSHA|AKKA|‚ù§"); } });
    }
    init();
    return { simulate: function(action){ performAction(action); } };
}());

// ======================
// ShapeBuilder and Shape
// (Simple implementation for letters/circle/rectangle)
// ======================
S.ShapeBuilder = {
    letter: function(l){ return { type:'letter', value:l }; },
    rectangle: function(w,h){ return { type:'rectangle', w:w, h:h }; },
    circle: function(r){ return { type:'circle', r:r }; }
};
S.Shape = {
    current:null,
    switchShape:function(s){ this.current=s; },
    render:function(){
        var ctx=S.Drawing.getContext(); ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
        if(!this.current) return;
        ctx.fillStyle="#fff";
        if(this.current.type==='letter'){
            ctx.font="80px Arial"; ctx.textAlign="center"; ctx.fillText(this.current.value, window.innerWidth/2, window.innerHeight/2);
        } else if(this.current.type==='rectangle'){
            ctx.fillRect(window.innerWidth/2-this.current.w/2, window.innerHeight/2-this.current.h/2, this.current.w, this.current.h);
        } else if(this.current.type==='circle'){
            ctx.beginPath(); ctx.arc(window.innerWidth/2, window.innerHeight/2, this.current.r,0,2*Math.PI); ctx.fill();
        }
    }
};

// ======================
// Start animation
// ======================
S.init();
</script>

</body>
</html>
